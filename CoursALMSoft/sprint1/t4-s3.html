<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"><html lang="en-US">  <head>    <meta http-equiv="content-type" content="text/html; charset=utf-8">    <title>Workshop: Programming Basics</title>    <meta name="CHANGEDBY" content="Pr. Olivier Gruber">    <link rel="stylesheet" href="../style.css" type="text/css">    <script src="../common.js"></script>    <script src="../quizz.js"></script>    <link rel="stylesheet" href="../highlight.js/styles/default.css">    <script src="../highlight.js/highlight.pack.js"></script>    <script>hljs.initHighlightingOnLoad();</script>  </head>  <body onload="shellOnLoad()">    <script>      function shellOnLoad() {        multiLang();        /*hljs.initHighlightingOnLoad(); */        _quizzes = new Array();        parseQuizzes();      }      </script>    <div id="outer-container">      <div id="header">        <div id="logo"> <img src="../logo_uga.png" alt="Université Grenoble-Alpes"            height="100"            border="0">          <img src="../logo_reseau_polytech.gif" alt="Polytech" height="80" border="0">        </div>        <div id="top-links"> <a href="../index.html">Home</a> </div>      </div>      <div id="inner-container">        <h1>Sprint: Assembly Programming Basics</h1>        <h2>Task4 -- Gestion de la pile</h2>        <h3>Step 3 -- Le cas de l'adresse de retour</h3>        <p>Maintenant, essayons pour de vrai notre nouvelle fonction <i>_fact</i>.          Donc, modifiez le fichier source <span style="font-style: italic;">start.s</span>          pour inclure un appel à notre fonction <span style="font-style: italic;">_fact</span>.&nbsp;


          </p>        <pre><code class="arm"><br>.global _start<br>_start:<br>	mov sp, #0xFF<br>.L6:<br>	mov r0, #3<br>	bl _fact<br>	mov r0,#0<br>_halt:<br>	b _halt<br>	</code></pre>        <p>Essayez d'exécuter le programme. Que se passe t il ?<br>          Le programme arrive t il à l'étiquette <span style="font-style: italic;">_halt</span>          ?<br>          Pourquoi boucle t-il ? </p>        <span style="font-family: monospace;"></span>        <p>En fait l'adresse de retour qui est sauvegardée dans le registe <span            style="font-style: italic;">lr</span>          à chaque <span style="font-style: italic;">bl _fact </span>est          écrasée par l'appel à <span style="font-style: italic;">fact</span>          suivant.</p>        <p> Il faut donc sauvegarder l'adresse de retour (<span style="font-style: italic;">lr</span>)          sur la pile et restaurer sa valeur avant l'instruction de retour (<span            style="font-style: italic;">move            pc, lr</span>). <br>        </p>        <p>Cela peut donner quelque chose comme ça: </p>        <pre><code class="arm"><br>.align 2<br>.global _fact<br>	.type _fact,%function<br>	.func _fact,_fact<br>_fact:<br>        <br>	cmp r0, #1       // fact(1)=1<br>	bne .L0          // so if r0==1<br>	mov pc, lr       // return 1<br>.L0:<br>        </code><br><codeclass="arm">	push {r1,lr}	 // save r1 and lr<br></code><codeclass="arm">	move r1,r0</code><br><codeclass="arm">&nbsp;	sub r0,r0,#1     // compute (n-1)!<br>        bl _fact         // by recursively calling  _fact<br>	mul r0, r1, r0   // compute n*(n-1)!<br>	pop {r1,lr}      // restore r1 et lr<br>	move pc, lr	 //return<br>	.size	_sum, .-_sum<br>	.endfunc <br>	</code></pre>        <p>Essayez et vérifiez que ce programme fonctionne.</p>        <p>Peux t on dépiler directement l'adresse de retour dans le registre pc          ?</p>        <p>Si oui faites le.<br>        </p>        <br>        <div id="footer"> © UFR IM2AG          <div id="bottom-links" style="float: right;"> <a href="../index.html">Home</a>          </div>        </div>      </div>    </div>  </body></html>