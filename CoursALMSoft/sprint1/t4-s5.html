<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"><html lang="en-US">  <head>    <meta http-equiv="content-type" content="text/html; charset=utf-8">    <title>Workshop: Programming Basics</title>    <meta name="CHANGEDBY" content="Pr. Olivier Gruber">    <link rel="stylesheet" href="../style.css" type="text/css">    <script src="../common.js"></script>    <script src="../quizz.js"></script>    <link rel="stylesheet" href="../highlight.js/styles/default.css">    <script src="../highlight.js/highlight.pack.js"></script>    <script>hljs.initHighlightingOnLoad();</script>  </head>  <body onload="shellOnLoad()">    <script>      function shellOnLoad() {        multiLang();        /*hljs.initHighlightingOnLoad(); */        _quizzes = new Array();        parseQuizzes();      }      </script>    <div id="outer-container">      <div id="header">        <div id="logo"> <img src="../logo_uga.png" alt="Université Grenoble-Alpes"            height="100"            border="0">          <img src="../logo_reseau_polytech.gif" alt="Polytech" height="80" border="0">        </div>        <div id="top-links"> <a href="../index.html">Home</a> </div>      </div>      <div>        <h1>Sprint: Assembly Programming Basics</h1>        <h2>Task4 -- Gestion de la pile</h2>        <h3>Step 5 -- Travail Pratique : La pile en C</h3>        <p>Afin de vérifier si vous avez compris l'ensemble des notions autour          des fonctions et de la pile, vous allez réaliser ce TP et rendre un          compte rendu.</p>        <p> Le TP consiste en deux parties :<br>          1) Observer du code assembleur, observer son exécution sous GDB et à          répondre à un certain nombre de questions. <br>          2) Des exercices de programmation au choix. </p>        <h4>Questions d'analyse</h4>        <p>Placez vous dans le répertoire task4s5C.</p>        <ul>          <li><b>Compréhension de l'algorithme :</b></li>        </ul>        <p> Le programme fiboprint.c affiche les n éléments de la suite de          Fibonacci, le nième élément de la suite Fn est défini par:</p>        <p><b><i>if n=0 alors Fn=0</i></b></p>        <b><i> </i></b>        <p><b><i>if n=1 alors Fn=1</i></b></p>        <b><i> </i></b>        <p><b><i>Sinon Fn= Fn-1+Fn-2;</i></b></p>        <p>Compilez le programme fiboprint.c à l'aide de la commande make -f          Makefileprint</p>        <p>Faites tourner le programme pour quelques valeurs de n.</p>        <p>En observant le code C, comprenez comment est calculé Fn.</p>        <ol>          <li>0 Pourquoi pour un <i>n</i> grand, le programme délivre t-il des            entiers négatifs ?</li>        </ol>        <ul>          <li><b>Analyse de l'assembleur:</b></li>        </ul>        <p>Compilez le programme <i>fibo.c</i> (même chose que fiboprint.c sans          l'appel à la fonction printf) en utilisant la commande <i>make</i>          puis ouvrez le fichier <i>fibo.s</i> pour observer ce que GCC a          généré comme assembleur.</p>        <p> Exécutez le programme sous GDB en vous arrêtant aux bons endroits en          en observant les variables, les registres, la pile .... </p>        <p> </p>        <ol>          <li>A quelle adresse commence la pile ? comment le savez-vous ?</li>          <li>Dessinez l'état de la pile après la deuxième instruction du <i>main</i>            (<i>add fp, sp, #4</i>).</li>          <li>Donnez la valeur (en hexadécimal) de <i>fp</i> et <i>sp</i> à ce            moment là.</li>          <li>Où sont stockées les deux variables locales du main: <i>x</i> et            <i>res</i> ?</li>          <li>Dessinez la pile après l'initialisation de <i>x</i>. On précisera            les emplacements des variables par rapport à <i>fp</i>.</li>          <li>Comment est passé le paramètre effectif de la fonction&nbsp;<i>fibo              </i>? </li>          <li>Au début de la fonction fibo, expliquez l'instruction            <p style="margin: 0.0px 0.0px 0.0px 0.0px; background-color: #ffffff"><font                style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"                face="Menlo"                size="3"                color="#000000"><spanclass="Apple-tab-span"style="white-space:pre">	</span>push<spanclass="Apple-tab-span"style="white-space:pre">	</span>{fp,                lr}</font></p>          </li>          <li>Dessinez l'état de la pile une fois dans la fonction <i>fibo</i>            (après l'instruction <i>sub sp, sp, #16), </i>précisez            l'emplacement des variables locales de la fonction <i>fibo</i></li>          <li>Comment est traduit l'instruction<i> </i><font style="font: 12.0px Menlo; color: #9b2393"              face="Menlo"              size="3"              color="#9b2393"><b>                if</b></font><font style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"              face="Menlo"              size="3"              color="#000000">              (n==</font><font style="font: 12.0px Menlo; color: #1c00cf" face="Menlo"              size="3"              color="#1c00cf">0</font><font              style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"              face="Menlo"              size="3"              color="#000000">)            </font><font style="font: 12.0px Menlo; color: #9b2393" face="Menlo"              size="3"              color="#9b2393"><b>return</b></font><font              style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"              face="Menlo"              size="3"              color="#000000">              (</font><font style="font: 12.0px Menlo; color: #1c00cf" face="Menlo"              size="3"              color="#1c00cf">0</font><font              style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"              face="Menlo"              size="3"              color="#000000">);              ?</font></li>          <li>Comment est traduit le return(0):</li>          <ul>            <li>Comment est retournée la valeur de la fonction ?</li>            <li>Expliquez les trois dernières instructions de la fonction <i>fibo</i>:            </li>            <li><font style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)" face="Menlo"                size="3"                color="#000000">sub<spanclass="Apple-tab-span"style="white-space:pre">	</span>sp,                fp, </font><font style="font: 12.0px Menlo; color: #5d6c79" face="Menlo"                size="3"                color="#5d6c79">#4</font>              <p style="margin: 0.0px 0.0px 0.0px 0.0px; background-color: #ffffff"><font                  style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"                  face="Menlo"                  size="3"                  color="#000000"><spanclass="Apple-tab-span"style="white-space:pre">	</span>pop<spanclass="Apple-tab-span"style="white-space:pre">	</span>{fp,                  lr}</font></p>              <p style="margin: 0.0px 0.0px 0.0px 0.0px; background-color: #ffffff"><font                  style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"                  face="Menlo"                  size="3"                  color="#000000"><spanclass="Apple-tab-span"style="white-space:pre">	</span>bx<spanclass="Apple-tab-span"style="white-space:pre">	</span></font><font                  style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"                  face="Menlo"                  size="3"                  color="#000000"><spanclass="Apple-tab-span"style="white-space:pre"></span>lr</font></p>            </li>          </ul>          <li>            <p style="margin: 0.0px 0.0px 0.0px 0.0px; background-color: #ffffff">Expliquez              comment sont passés les trois paramètres de l'appel de la              fonction&nbsp;            </p>            <p style="margin: 0.0px 0.0px 0.0px 0.0px; background-color: #ffffff"><font                style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"                face="Menlo"                size="3"                color="#000000">fibolin(n,&amp;a,&amp;ap)<span                  style="color: black;"><span                    style="font-family: serif;">;                    <br>                  </span></span></font></p>          </li>          <li>            <p style="margin: 0.0px 0.0px 0.0px 0.0px; background-color: #ffffff"><font                style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"                face="Menlo"                size="3"                color="#000000"><span                  style="color: black;"><span                    style="font-family: serif;"></span></span></font><span                style="font-family: Arial,serif;"></span>Expliquez              pourquoi c'est l'adresse de <i>a</i> et <i>ap</i> qui sont              passées en paramètre et non leur valeur.&nbsp;</p>          </li>          <li>            <p style="margin: 0.0px 0.0px 0.0px 0.0px; background-color: #ffffff">Donnez              l'adresse en mémoire de la variable <i>a</i> (en hexadécimal). </p>          </li>          <li>Dessinez l'état de la pile une fois dans la fonction <i>fibolin</i>            (après l'instruction&nbsp;<i><i>sub sp, sp, #24</i>) </i>en            précisant l'emplacement des variables locales<i> i </i>et<i> j </i>de            la fonction.<i><br>            </i></li>          <li>Pourquoi les paramètres sont ils stockés ensuite sur la pile ?</li>          <li>Comment est traduite l'instruction C<br>            <p style="margin: 0.0px 0.0px 0.0px 0.0px; background-color: #ffffff"><font                style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"                face="Menlo"                size="3"                color="#000000">*k                = n;</font></p>            dans la fonction <i>fibolin </i>?</li>          <li>Vérifiez que c'est bien la variable <i>a</i> du main qui est            modifiée lors de l'instruction<font style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"              face="Menlo"              size="3"              color="#000000">              *k = n;</font> . Observez sous gdb la pile à ce moment là, et            donnez la valeur et l'adresse (en hexadecimal) de la variable<i> a</i>.</li>          <li>Retrouvez en affichant sous gdb la pile à ce moment là, la valeur            et l'adresse du paramètre<i> k</i>.</li>          <li>Retrouvez dans l'assembleur l'appel récursif de la fonction <i>fibolin</i>:            <p style="margin: 0.0px 0.0px 0.0px 0.0px; background-color: #ffffff"><font                style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"                face="Menlo"                size="3"                color="#000000">fibolin(n-</font><font                style="font: 12.0px Menlo; color: #1c00cf"                face="Menlo"                size="3"                color="#1c00cf">1</font><font                style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"                face="Menlo"                size="3"                color="#000000">,&amp;i,&amp;j);</font></p>          </li>          <li>Dessinez l'état de la pile après ce premier appel récursif de la            fonction de<i> fibolin </i><i>(après l'instruction&nbsp;<i><i>sub                  sp, sp, #24</i>)</i>.</i></li>          <li>Quelle sera la valeur de <i>PC</i> une fois le retour de la            fonction <i>main</i> effectué ?<i> </i>Et dans le cas de où le            programme n'est pas exécuté sur QEMU mais sur le processeur de votre            machine (cas de fiboprint).<i><br>            </i></li>        </ol>        <ol>          <ol>          </ol>        </ol>        <span style="font-family: serif;"></span>        <p><br>        </p>        <ol>        </ol>        <p></p>        <h4>Exercices de programmation</h4>        <p> Réalisez les exercices de programmations ci-dessous. Il ne vous est          <b>pas demandé de tous les faire</b>, seulement <b>au moins un            exercice en assembleur ARM, et un en C</b>. Choisissez ceux qui vous          inspirent le plus. Les exercices sont classés par ordre de difficulté.        </p>        <p> </p>        <h5>Exercice 1 (ARM) : print_string</h5>        Ecrivez en assembleur ARM, une fonction <b>print_string</b> qui prend        en paramètre une adresse d'une chaîne de caractère (par le registre r0),        et l'affiche. <br>        Vous devrez utiliser la fonction <b>_writec</b> contenue dans le        fichier <i>io.s</i>. <br>        Voici un exemple d'utilisation de la fonction.        <p></p>        <pre><code class="arm">_start:    ldr r0, .string_ptr    bl print_string/*...*/.string_ptr:    .word stringstring:    .ascii "HELLO WORLD!\000"        </code></pre>        <p> Comme vous pouvez le constater, la chaîne de caractère termine avec          <b><i>"\000"</i></b>. Cela sert à repérer la fin de la chaîne en la          terminant par un 0. </p>        <p> </p>        <h5>Exercice 2 (C) : print_string</h5>        Même exercice que l'exercice 1 mais en C.        <p></p>        <p> </p>        <h5>Exercice 3 (ARM) : console</h5>        Ecrivez un programme qui permet à l'utilisateur de saisir du texte dans        le terminal de qemu. Le texte saisie par l'utilisateur doit s'afficher à        l'écran en temps réel. <br>        Lorsque l'utilisateur appuie sur entrée, le programme affiche sur une        nouvelle ligne, le texte saisie en majuscule. Si le texte contient des        caractères qui ne sont pas des lettres, elles ne doivent pas être        modifiées.<br>        Exemple d'affichage du programme :        <p></p>        <pre><code>je suis dans la console qemuJE SUIS DANS LA CONSOLE QEMUJe Peux saisir DU texteJE PEUX SAISIR DU TEXTEQu1 c0nt13nt De5 ch1ffres et De5 Lettr3sQU1 C0NT13NT DE5 CH1FFRES ET DE5 LETTR3S        </code></pre>        <p> Vous aurez besoin des fonctions <b><i>_writec</i></b> et <b><i>_readc</i></b>          du fichier <i>io.s</i> </p>        <p> </p>        <h5>Exercice 4 (C) : console</h5>        Même exercice que l'exercice 3 mais en C.        <p></p>        <p> </p>        <h5>Exercice 5 (ARM) : print_hex</h5>        Ecrivez une fonction <b>print_hex</b> qui prend en entrée un entier        (dans le registre r0) et affiche son contenu sous forme hexadecimal.        Exemple (0x003FA6EC). Affichez les 0 de telle sorte que le nombre total        de caractère soit toujours 8 (les registres font 32 bits).        <p></p>        <p> </p>        <h5>Exercice 6 (C) : print_hex</h5>        Même exercice que l'exercice 5 mais en C.        <p></p>        <p> </p>        <h5>Exercice 7 : Exercice libre</h5>        Pour les plus motivés, réalisez le programme que vous voulez en        respectant les règles suivantes :        <ol>          <li>Il doit contenir un mélange d'assembleur ARM et de C. Vous êtes            libre de choisir les proportions de C et d'assembleurs, l'important            est d'être capable d'écrire des fonctions dans un language,            utilisées dans un autre.</li>          <li>Il doit être interractif. L'utilisateur doit saisir du texte ou            commander le programme au clavier.</li>          <li>Il doit être commenté le mieux possible. Sans fournir une            documentation complète, un minimum de commentaires sont demandés            pour aider à la navigation dans le code.</li>        </ol>        Soyez créatifs, et surtout, amusez vous !        <p></p>        <div id="footer"> © UFR IM2AG          <div id="bottom-links" style="float: right;"> <a href="../index.html">Home</a>          </div>        </div>      </div>    </div>  </body></html>