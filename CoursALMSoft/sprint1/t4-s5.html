<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"><html lang="en-US">  <head>    <meta http-equiv="content-type" content="text/html; charset=utf-8">    <title>Workshop: Programming Basics</title>    <meta name="CHANGEDBY" content="Pr. Olivier Gruber">    <link rel="stylesheet" href="../style.css" type="text/css">    <script src="../common.js"></script>    <script src="../quizz.js"></script>    <link rel="stylesheet" href="../highlight.js/styles/default.css">    <script src="../highlight.js/highlight.pack.js"></script>    <script>hljs.initHighlightingOnLoad();</script>  </head>  <body onload="shellOnLoad()">    <script>      function shellOnLoad() {        multiLang();        /*hljs.initHighlightingOnLoad(); */        _quizzes = new Array();        parseQuizzes();      }      </script>    <div id="outer-container">      <div id="header">        <div id="logo"> <img src="../logo_uga.png" alt="Université Grenoble-Alpes"            border="0"            height="100">          <img src="../logo_reseau_polytech.gif" alt="Polytech" border="0" height="80">        </div>        <div id="top-links"> <a href="../index.html">Home</a> </div>      </div>      <div>        <h1>Sprint: Assembly Programming Basics</h1>        <h2>Task4 -- Gestion de la pile</h2>        <h3>Step 5 -- Travail Pratique : La pile en C</h3>        <dl>          <dt>Afin de vérifier si vous avez compris l'ensemble des notions sur            l'assembleur ARM (en particulier les appels de fonctions et la            pile), vous devez réaliser ce TP en binôme et rendre un compte            rendu.</dt>        </dl>        <br>        Le TP consiste en deux parties :</div>      <div><br>      </div>      <div>&nbsp; &nbsp;&nbsp;&nbsp; &nbsp;&nbsp;&nbsp; 1) Observer du code        assembleur, observer son exécution sous GDB et à répondre à un certain        nombre de questions.        <dl>          <dt style="margin-left: 40px;">2) Des exercices de programmation au            choix. </dt>        </dl>        <dl>        </dl>        <h4>Questions d'analyse</h4>        <dl>          <dt>Placez vous dans le répertoire task4s5C.</dt>        </dl>        <ul>          <li><b>Compréhension de l'algorithme :</b></li>        </ul>        <dl>          <dt> Le programme <i>erastoprint.c</i> affiche les nombres premiers            inférieurs ou égal à N. L'algorithme utilisé est connu sous le nom            de crible d'Erastothène (mathématicien Grec 276 an Av J.-C)</dt>        </dl>        <dl>        </dl>        <span style="font-family: Arial,serif;">&nbsp;&nbsp;&nbsp; -</span>        Compilez le programme <i>erastoprint.c</i> à l'aide de la commande <i>make
          erasto</i></div>      <div><br>      </div>      <div>&nbsp;&nbsp;&nbsp; - Faites tourner le programme pour différentes        valeurs de la constante N.<span></span>        <dl>          <dt> <br>          </dt>          <dt>En observant le code C, comprenez comment sont calculés les            nombres premiers.</dt>          <dt><br>          </dt>          <dt>Q1- En quelques phrases persuadez moi de la validité de            l'algorithme.</dt>          <dd><br>          </dd>          <dt>Q2- Expliquez les caractères $@ et $&lt; apparaissant dans le            makefile</dt>          <dt> <br>          </dt>        </dl>        <dl>        </dl>        <p><br>        </p>        <ul>          <li><b>Analyse de l'assembleur:</b></li>        </ul>        <dl>        </dl>        <div><dt style="margin-left: 40px;">- Compilez le programme erasto<i>.c</i>            (même chose que erastoprint.c sans l'appel à la fonction printf) en            utilisant la commande <i>make</i> puis ouvrez le fichier <i>erasto.s</i>            pour observer ce que GCC a généré comme assembleur ARM.</dt>        </div>        <dl>        </dl>        <div><dt style="margin-left: 40px;"> -Exécutez le programme sous GDB en            vous arrêtant aux bons endroits en en observant les variables, les            registres, la pile .... </dt>        </div>        <dl>          <dt> <br>          </dt>          <dt>Q3- A quelle adresse commence la pile ? Comment le savez-vous ?</dt>          <dd><br>          </dd>          <dt>Q4- Dessinez l'état de la pile après la troisième instruction du <i>main</i>            (<i>sub sp, sp, #40</i>). Précisez les cases pointées par <i>sp</i>            et <i>fp</i>.</dt>          <dd><br>          </dd>          <dt>Q5- Donnez la valeur (en hexadécimal) de <i>fp</i> et <i>sp</i>            à ce moment là.</dt>          <dt><br>          </dt>          <dt>Q6- Où sont stockées les trois variables locales du main: <i>tab,              i&nbsp;</i> et <i>j</i> ? Donnez la valeur en hexadécimal de            leurs adresses. </dt>          <dt><br>          </dt>          <dt>Q7- Donnez en hexadécimal l'adresse de tab[N-1]<span style="font-family: Arial,serif;">.            </span>Complétez le dessin&nbsp; de&nbsp; la pile en donnant            l'emplacement des variables locales du main. Précisez leur adresses            en héxadécimal et par rapport au contenu du registre <i>fp</i> (<i>fp-x</i>).<span              style="font-family: Arial,serif;"><br>            </span></dt>        </dl>        <dl>        </dl>        <dl>          <dt>Q8- Expliquez comment est traduite l'instruction <i>for              (i=0;&nbsp; i&lt;N;&nbsp; i++) </i>en précisant le calcul de la            condition d'arrêt de la boucle et les étiquettes utilisées.</dt>          <dd><br>          </dd>          <dt>Q9- Comment sont passés les valeurs des paramètres à la fonction <i>affecttab</i>            ? Donnez la valeur en hexadécimal la valeur de ces trois paramètres            avant de rentrer dans la fonction. </dt>          <dd><br>          </dd>          <dt>Q10- Au début de la fonction <i>affecttab</i>, expliquez            l'instruction            <p style="margin: 0.0px 0.0px 0.0px 0.0px; background-color: #ffffff"><font                style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"                size="3"                color="#000000"                face="Menlo"><spanclass="Apple-tab-span"style="white-space:pre">	</span>push<spanclass="Apple-tab-span"style="white-space:pre">	</span>{fp,
                lr}</font></p>          </dt>          <dd><br>          </dd>          <dt>Q11- Dessinez l'état de la pile une fois dans la fonction <i>affecttab</i>            (après l'instruction <i>sub sp, sp, #20), <br>            </i></dt>          <dt><br>          </dt>          <dt>Q12- Où sont stockés les paramètres de la fonction ? Précisez            leurs emplacements en mémoire (en hexadécimal et par rapport            au&nbsp; contenu de <i>fp</i>).</dt>        </dl>        <dl>          <dt>Q13- Comment est réalisée l'affectation <i>*(tab+i)=val </i></dt>          <dt>Donnez la valeur en hexadécimal de <i>tab+i</i>.</dt>          <dd><br>          </dd>          <dt>Q14- Observez sous gdb la pile à ce moment là, et donnez la valeur            et l'adresse (en hexadécimal) de la case du tableau tab modifiée.</dt>          <dd><br>          </dd>          <dt>Pourquoi l'instruction <i>strb</i> est utilisée ici ? </dt>          <dt>Quel est l'intérêt de l'instruction <i>and r2, r2, #255 </i>?</dt>        </dl>        <dl>          <dt>Q15- Expliquez les trois dernières instructions de la fonction <i>              affecttab</i>. Donnez la valeur X en hexadécimal du registre <i>lr</i>            au moment de l'instruction <i>bx lr. </i>Quelle est l'instruction            qui se trouve en mémoire à l'adresse X ? </dt>        </dl>        <dl>          <dd>Rappel : l'instruction <i>bx reg</i> effectue un branchement à            l'adresse contenu dans le registre <i>reg</i>.<span style="font-family: Arial,serif;"></span></dd>          <dd><br>            <span style="font-family: Arial,serif;"></span></dd>        </dl>        <dl>          <dt>Q16- Dans la fonction <i>main</i> retrouvez et commentez la            traduction en ARM de if (tab[i])</dt>        </dl>        <dl>          <dt>Q17- Donnez la valeur des 4 octets codant l'instruction <i>beq              .L4</i></dt>          <dt>Retrouvez la signification des différents champs de cette            instruction dans la documentation ARM fournie (page 6) (<a href="../Documentations/docarm.pdf"              target="_blank">doc_arm.pdf</a>).</dt>          <dt>Expliquez en particulier la valeur des champs <i>cond</i> et <i>déplacement</i>            de cette instruction.</dt>          <dt><br>          </dt>          <dt>Q18- Retrouvez et commentez la traduction en assembleur de j= i*2;            <br>            <span style="font-family: Arial,serif;"></span></dt>        </dl>        <dl>          <dt>Q19- Donnez les adresses et les valeurs du tableau <i>tab</i> à            la fin du programme <i>main</i>, retrouvez les nombres premiers à            l'aide de celui-ci.</dt>          <dd><br>          </dd>          <dt>Q20- Quelle sera la valeur de <i>PC</i> une fois le retour de la            fonction <i>main</i> effectué ?<i> </i>Que contiendrait PC une            fois le retour du main effectué dans le cas où le programme n'est            pas exécuté sur QEMU mais sur le processeur de votre machine (cas de            <i>erastoprint</i>).<i><br>            </i></dt>          <dt> <br>          </dt>          <dl>          </dl>        </dl>        <ol>        </ol>        <h4>Exercices de programmation</h4>        <dl>          <dt> Réalisez les exercices de programmations ci-dessous.&nbsp; Les            exercices sont classés par ordre de difficulté. Faites au moins deux            de ces exercices.</dt>          <dt>Le code&nbsp; Assembleur ou C doit être commenté le mieux            possible. Sans fournir une documentation complète, un minimum de            commentaires sont demandés pour aider à la compréhension du code.</dt>          <dt>Vous pouvez fournir des tests permettant de se persuader que vos            programmes fonctionnent correctement.</dt>        </dl>        <p> </p>        <h5>Exercice 1&nbsp; : Affichage d'une chaine de caractères</h5>        1- Ecrivez en assembleur ARM, une fonction <b>print_string</b> qui        prend en paramètre une adresse d'une chaîne de caractère (passé par le        registre r0), et l'affiche. <br>        Vous devrez utiliser la fonction <b>_writec</b> contenue dans le        fichier <i>io.s</i>. <br>        Voici un exemple d'utilisation de la fonction.        <pre><code class="arm">_start:    ldr r0, .string_ptr    bl print_string/*...*/.string_ptr:    .word stringstring:    .ascii "CA MARCHE ! \000"        </code></pre>        <dl>          <dt> Comme vous pouvez le constater, la chaîne de caractère termine            avec <b><i>"\000"</i></b>. Cela sert à repérer la fin de la chaîne            en la terminant par un 0. </dt>        </dl>        <dl>          <dt>Vous pouvez vous servir des fichiers se trouvant dans <i>le              répertoire FichiersExercices/EXO1ARM</i></dt>        </dl>        <dl>        </dl>        <p> </p>        2- Réalisez l'appel de <i>print_string</i> depuis un programme C.</div>      <div>Vous pouvez vous servir des fichiers se trouvant dans <i>FichiersExercices/EXO1C</i>        <p> </p>        <h5>Exercice 2 : Console</h5>        1- Ecrivez une fonction qui permet à l'utilisateur de saisir du texte        dans le terminal de <i>qemu</i>. Le texte saisie par l'utilisateur doit        s'afficher à l'écran en temps réel. </div>      <div>Voici un exemple d'utilisation de la fonction.<code class="arm"> </code>        <pre><code class="arm">_start:    bl saisie_string</code></pre></div>      <div> Lorsque l'utilisateur appuie sur entrée, le programme affiche sur        une nouvelle ligne, le texte saisie en majuscule. Si le texte contient        des caractères qui ne sont pas des lettres, elles ne doivent pas être        modifiées.</div>      <div><br>      </div>      <div> Exemple d'affichage du programme :        <pre><code>je suis dans la console qemuJE SUIS DANS LA CONSOLE QEMUJe Peux saisir DU texteJE PEUX SAISIR DU TEXTEQu1 c0nt13nt De5 ch1ffres et De5 Lettr3sQU1 C0NT13NT DE5 CH1FFRES ET DE5 LETTR3S        </code></pre>        <dl>          <dt> Vous aurez besoin des fonctions <i><b>_writec</b></i> et <b><i>_readc</i></b>            du fichier <i>io.s</i></dt>          <dt><br>          </dt>        </dl>        <p> </p>        2- Réalisez l'appel de <i>saisie_string</i> depuis un programme C.<br>        <p> </p>        <h5>Exercice 3&nbsp; : Ecriture en hexadécimal</h5>        1- Ecrivez <b>en langage C </b>une&nbsp; procédure <i>print_hex</i>        qui prend en entrée un entier sur un octet <i>x</i> et qui affecte les        cases d'un tableau <i>ValAscii</i> (de deux octets) avec les valeurs        des codes ASCII de l'affichage en hexadécimal de cet octet. </div>      <div><i>void print_hex(char x, char *ValAscii);</i></div>      <div><i><br>        </i></div>      <div> Exemple : X= 35 = 0x23,&nbsp; la fonction affecte le tableau <i>ValAscii</i>        avec les valeurs (décimales) 62 et 63</div>      <div>        <p> </p>        2- Ecrivez un programme en assembleur qui appelle la fonction C        précedemment écrite et qui affiche dans le terminal de <i>qemu</i> les        chiffres de la valeur en hexadécimal de X.</div>      <div><br>      </div>      <div>        <p style="margin: 0.0px 0.0px 0.0px 0.0px; background-color: #ffffff"><font            style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"            size="3"            color="#000000"            face="Menlo">.text</font></p>        <p style="margin: 0.0px 0.0px 0.0px 0.0px; background-color: #ffffff"><font            style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"            size="3"            color="#000000"            face="Menlo">.align<span              class="Apple-converted-space">&nbsp;              </span></font><font style="font: 12.0px Menlo; color: #1c00cf" size="3"            color="#1c00cf"            face="Menlo">2</font></p>        <p style="margin: 0.0px 0.0px 0.0px 0.0px; background-color: #ffffff"><font            style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"            size="3"            color="#000000"            face="Menlo">.global            main</font></p>        <p style="margin: 0.0px 0.0px 0.0px 0.0px; background-color: #ffffff"><font            style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"            size="3"            color="#000000"            face="Menlo">main:</font></p>        <p style="margin: 0.0px 0.0px 0.0px 0.0px; background-color: #ffffff"><font            style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"            size="3"            color="#000000"            face="Menlo">ldr            r0,AdX</font></p>        <p style="margin: 0.0px 0.0px 0.0px 0.0px; background-color: #ffffff"><font            style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"            size="3"            color="#000000"            face="Menlo">ldrb            r0,[r0]</font></p>        <p style="margin: 0.0px 0.0px 0.0px 0.0px; background-color: #ffffff"><font            style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"            size="3"            color="#000000"            face="Menlo">ldr            r1, AdTabAscii</font></p>        <p style="margin: 0.0px 0.0px 0.0px 0.0px; background-color: #ffffff"><font            style="font: 12.0px Menlo; color: #5d6c79"            size="3"            color="#5d6c79"            face="Menlo">//....</font></p>        <p style="margin: 0.0px 0.0px 0.0px 0.0px; background-color: #ffffff"><font            style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"            size="3"            color="#000000"            face="Menlo">AdX:            .word X</font></p>        <p style="margin: 0.0px 0.0px 0.0px 0.0px; background-color: #ffffff"><font            style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"            size="3"            color="#000000"            face="Menlo">AdTabAscii:            .word TabAscii</font></p>        <p style="margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Menlo; color: #000000; color: rgba(0, 0, 0, 0.85); background-color: #ffffff; min-height: 14.0px"><br>        </p>        <p style="margin: 0.0px 0.0px 0.0px 0.0px; background-color: #ffffff"><font            style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"            size="3"            color="#000000"            face="Menlo">.data</font></p>        <p style="margin: 0.0px 0.0px 0.0px 0.0px; background-color: #ffffff"><font            style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"            size="3"            color="#000000"            face="Menlo">X:</font></p>        <p style="margin: 0.0px 0.0px 0.0px 0.0px; background-color: #ffffff"><font            style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"            size="3"            color="#000000"            face="Menlo">&nbsp;&nbsp;&nbsp;            .byte </font><font style="font: 12.0px Menlo; color: #1c00cf" size="3"            color="#1c00cf"            face="Menlo">35</font></p>        <p style="margin: 0.0px 0.0px 0.0px 0.0px; background-color: #ffffff"><font            style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"            size="3"            color="#000000"            face="Menlo">TabAscii:</font></p>        <p style="margin: 0.0px 0.0px 0.0px 0.0px; background-color: #ffffff"><font            style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"            size="3"            color="#000000"            face="Menlo"><span              class="Apple-converted-space">&nbsp;              &nbsp; </span>.byte </font><font style="font: 12.0px Menlo; color: #1c00cf"            size="3"            color="#1c00cf"            face="Menlo">0</font></p>        <p style="margin: 0.0px 0.0px 0.0px 0.0px; background-color: #ffffff"><font            style="font: 12.0px Menlo; color: rgba(0, 0, 0, 0.85)"            size="3"            color="#000000"            face="Menlo"><span              class="Apple-converted-space">&nbsp;              &nbsp; </span>.byte 0 </font></p>        <p style="margin: 0.0px 0.0px 0.0px 0.0px; background-color: #ffffff"><br>        </p>      </div>      <div>        <p></p>        <p> </p>        Vous pouvez vous servir des fichiers se trouvant dans        FichiersExercices/EXO3        <h5><i></i>Exercice 4 : Exercice libre</h5>        Pour les plus motivés, réalisez le programme que vous voulez en        respectant les règles suivantes:        <ol>        </ol>        <div><dt style="margin-left: 40px;">- Il doit contenir un mélange            d'assembleur ARM et de C. Vous êtes libre de choisir les proportions            de C et d'assembleurs, l'important est d'être capable d'écrire des            fonctions dans un language, utilisées dans un autre.</dt>        </div>        <dl>          <dd>- Il doit être interactif. L'utilisateur doit saisir du texte ou            commander le programme au clavier.</dd>          <dt><br>          </dt>        </dl>        <ol>        </ol>        Soyez créatifs, et surtout, amusez vous !        <p></p>        <div id="footer"> © UFR IM2AG </div>        <div><br>          <div id="bottom-links" style="float: right;"> <a href="../index.html">Home</a>          </div>        </div>      </div>    </div>  </body></html>